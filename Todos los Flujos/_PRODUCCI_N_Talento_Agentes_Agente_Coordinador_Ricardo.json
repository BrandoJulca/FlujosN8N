{
  "name": "(PRODUCCI√ìN)Talento_Agentes_Agente_Coordinador_Ricardo",
  "nodes": [
    {
      "parameters": {
        "content": "## Sistema Multi-Agente para Reclutamiento:\n\n1. Coordinador (aka Orquestador)\nSupervisa el proceso completo de reclutamiento, asigna tareas espec√≠ficas a cada agente, monitorea el progreso y toma decisiones sobre siguientes pasos bas√°ndose en m√©tricas establecidas.\n\n2. Evaluador (aka Psic√≥logo)\nConduce entrevistas estructuradas para medir competencias t√©cnicas y blandas, analiza ajuste cultural y genera reportes detallados para toma de decisiones.\n\n3. Asesor (aka Consultor)\nAsegura calidad del proceso validando mejores pr√°cticas, analiza alineaci√≥n entre perfil y requisitos, identifica alertas durante el proceso.\n\n4. Orientador (aka Gu√≠a)\nMantiene di√°logo con candidatos, resuelve consultas sobre empresa/puesto, proporciona informaci√≥n de beneficios y cultura organizacional.\n\n5. Agendador (aka Planificador)\nOptimiza programaci√≥n de entrevistas, maneja disponibilidad y asegura comunicaci√≥n efectiva sobre horarios.\n\n6. Revisor (aka Validador)\nVerifica precisi√≥n y tono de respuestas antes de enviarlas al candidato, asegura consistencia de mensajes y sugiere mejoras en comunicaci√≥n.\n\n7. **Agente Registrador (aka Recolector)**\n\nGestiona la recopilaci√≥n inicial y estructurada de datos del candidato a trav√©s de WhatsApp, manteniendo una conversaci√≥n natural y progresiva. Valida en tiempo real la informaci√≥n proporcionada, asegura la completitud de los datos requeridos y prepara el perfil inicial del candidato para las siguientes etapas del proceso de reclutamiento.\n",
        "height": 640,
        "width": 820
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1460,
        -180
      ],
      "typeVersion": 1,
      "id": "3c7e60a6-ddd4-467c-a9ce-c5ad59927a6b",
      "name": "Sticky Note"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.3,
      "position": [
        3740,
        460
      ],
      "id": "0c0262d0-ce2d-43ce-b001-11facbbeffa3",
      "name": "Consultor",
      "disabled": true
    },
    {
      "parameters": {
        "name": "My_Guide_Tool",
        "description": "Call this tool whenever you need information related to the company, job details, or employment conditions.",
        "workflowId": {
          "__rl": true,
          "value": "z08nEuLFNLHEtgkE",
          "mode": "list",
          "cachedResultName": "Talento|Agentes|Agente Guia|Ricardo"
        },
        "specifyInputSchema": true,
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"sessionId\": {\n      \"type\": \"string\",\n      \"description\": \"WhatsApp number as unique session identifier\"\n    },\n    \"task_id\": {\n      \"type\": \"string\",\n      \"format\": \"ulid\",\n      \"description\": \"ULID for task tracking\"\n    },\n    \"message\": {\n      \"type\": \"string\",\n      \"description\": \"Candidate's WhatsApp response\"\n    },\n    \"agent_type\": {\n      \"type\": \"string\",\n      \"enum\": [\"guide\", \"scheduler\", \"reviewer\"],\n      \"description\": \"Type of agent to handle the task\"\n    },\n    \"context\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"current_stage\": {\n          \"type\": \"string\",\n          \"enum\": [\"initial\", \"query\", \"scheduling\", \"review\"],\n          \"description\": \"Current stage in recruitment process\"\n        },\n        \"last_interaction\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"description\": \"Timestamp of last interaction\"\n        }\n      }\n    }\n  },\n  \"required\": [\"sessionId\", \"task_id\", \"message\"]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.3,
      "position": [
        3340,
        460
      ],
      "id": "5660ad03-d46a-466d-bfed-1f68aaebd911",
      "name": "Gu√≠a"
    },
    {
      "parameters": {
        "jsCode": "/** \n * Funci√≥n para obtener la fecha y hora actual bas√°ndose en el c√≥digo de pa√≠s del n√∫mero de WhatsApp.\n * @param {string} remoteJid - El identificador remoto en formato 'c√≥digoPa√≠sn√∫mero@s.whatsapp.net'.\n * @returns {object} - Un objeto con la informaci√≥n de fecha, hora y zona horaria correspondiente.\n */\nfunction obtenerFechaHora(remoteJid) {\n  // Objeto para almacenar el resultado de la funci√≥n\n  const resultadoFechaHora = {\n    fechaHora: null,\n    zonaHoraria: null,\n    codigoPais: null,\n    error: null\n  };\n  \n  // Mapa de c√≥digos de pa√≠s a zonas horarias para Latinoam√©rica\n  const zonasHorarias = {\n    '54': 'America/Argentina/Buenos_Aires', // Argentina\n    '591': 'America/La_Paz',                // Bolivia\n    '55': 'America/Sao_Paulo',              // Brasil (zona principal)\n    '56': 'America/Santiago',               // Chile\n    '57': 'America/Bogota',                 // Colombia\n    '506': 'America/Costa_Rica',            // Costa Rica\n    '53': 'America/Havana',                 // Cuba\n    '593': 'America/Guayaquil',             // Ecuador\n    '503': 'America/El_Salvador',           // El Salvador\n    '502': 'America/Guatemala',             // Guatemala\n    '509': 'America/Port-au-Prince',        // Hait√≠\n    '504': 'America/Tegucigalpa',           // Honduras\n    '52': 'America/Mexico_City',            // M√©xico\n    '505': 'America/Managua',               // Nicaragua\n    '507': 'America/Panama',                // Panam√°\n    '595': 'America/Asuncion',              // Paraguay\n    '51': 'America/Lima',                   // Per√∫\n    '1': 'America/Puerto_Rico',             // Puerto Rico (EE.UU.)\n    '598': 'America/Montevideo',            // Uruguay\n    '58': 'America/Caracas'                 // Venezuela\n  };\n\n  try {\n    // Extraer el n√∫mero de tel√©fono eliminando la parte '@s.whatsapp.net'\n    const numeroSinDominio = remoteJid.replace('@s.whatsapp.net', '');\n    \n    // Extraer el c√≥digo de pa√≠s (probando c√≥digos de 1, 2 y 3 d√≠gitos)\n    for (let i = 1; i <= 3; i++) {\n      const posibleCodigo = numeroSinDominio.substring(0, i);\n      if (zonasHorarias[posibleCodigo]) {\n        resultadoFechaHora.codigoPais = posibleCodigo;\n        break;\n      }\n    }\n\n    // Verificar si se encontr√≥ un c√≥digo de pa√≠s v√°lido\n    if (!resultadoFechaHora.codigoPais) {\n      resultadoFechaHora.error = 'C√≥digo de pa√≠s no reconocido';\n      return resultadoFechaHora;\n    }\n\n    // Obtener la zona horaria correspondiente\n    resultadoFechaHora.zonaHoraria = zonasHorarias[resultadoFechaHora.codigoPais];\n    \n    // Obtener la fecha y hora actual en la zona horaria correspondiente\n    const opciones = { \n      timeZone: resultadoFechaHora.zonaHoraria, \n      hour12: false,\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit'\n    };\n    \n    const ahora = new Date();\n    resultadoFechaHora.fechaHora = ahora.toLocaleString('es-ES', opciones);\n    resultadoFechaHora.timestamp = ahora.getTime();\n    \n  } catch (err) {\n    resultadoFechaHora.error = `Error en el procesamiento: ${err.message}`;\n  }\n\n  return resultadoFechaHora;\n}\n\n// Obtener los datos del trigger\nconst workflowTrigger = $('Execute Workflow Trigger').first().json.body;\n\n// Crear el objeto de respuesta final\nconst respuesta = {\n  inputs: {\n    sessionId: workflowTrigger.inputs.remoteJid,\n    remoteJid: workflowTrigger.inputs.remoteJid,\n    pushName: workflowTrigger.inputs.pushName,\n    instanceName: workflowTrigger.inputs.instanceName,\n    serverUrl: workflowTrigger.inputs.serverUrl,\n    apiKey: workflowTrigger.inputs.apiKey\n  },\n  query: workflowTrigger.query,\n  user: workflowTrigger.user,\n  // Integrar los datos de fecha y hora\n  datosHorarios: obtenerFechaHora(workflowTrigger.inputs.remoteJid)\n};\n\n// Retornar un √∫nico objeto como resultado\nreturn respuesta;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2960,
        80
      ],
      "id": "0ff2c6c7-eb1f-4bb5-8464-bb576a6a4f68",
      "name": "Code"
    },
    {
      "parameters": {
        "name": "ulid_generator",
        "description": "call this tool when you need generates a ULID (Universally Unique Lexicographically Sortable Identifier)",
        "jsCode": "return new Date().getTime().toString(32) + \n          Math.random().toString(32).slice(2) + \n          Math.random().toString(32).slice(2);"
      },
      "type": "@n8n/n8n-nodes-langchain.toolCode",
      "typeVersion": 1.1,
      "position": [
        2860,
        460
      ],
      "id": "663b7734-146c-4fff-bdd8-80dbc4bf64ec",
      "name": "Generador_id_unico"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.inputs.toJsonString() }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=# ESPECIFICACI√ìN DEL AGENTE COORDINADOR\n\n## 0. IDENTIDAD\nSoy Talento, un Agente de IA desarrollado por Onbotgo para automatizar procesos de onboarding en reclutamiento. Mi prop√≥sito principal es orquestar la interacci√≥n entre agentes especializados, asegurando un flujo de proceso fluido y manteniendo el contexto de la conversaci√≥n durante todo el proceso de reclutamiento.\n\n### Valores Fundamentales\n- Eficiencia con empat√≠a\n- Precisi√≥n con personalidad\n- Automatizaci√≥n con autenticidad\n\n### Voz de Marca\nRepresento el compromiso de Onbotgo con:\n- Excelencia profesional\n- Innovaci√≥n en reclutamiento\n- Automatizaci√≥n centrada en el humano\n\n## 1. RESPONSABILIDADES DE ORQUESTACI√ìN\n\n### Funciones Principales\n- Delegar tareas a agentes especializados\n- Mantener el estado global de la conversaci√≥n\n- Asegurar la integridad del proceso\n- Coordinar respuestas de agentes\n- Nunca generar respuestas directas\n\n### Gesti√≥n de Estado\n- Rastrear etapas de conversaci√≥n\n- Mantener contexto del candidato\n- Monitorear progreso del proceso\n- Asegurar consistencia de datos\n\n## 2. HERRAMIENTAS Y ESPECIFICACIONES DE COMANDOS\n\n### Proceso de Revisi√≥n Obligatorio\nIMPORTANTE: El Reviewer_Tool DEBE ser el paso final antes de que CUALQUIER mensaje llegue al candidato. Sin excepciones.\n\nCadena de Proceso:\n```text\n[Cualquier Herramienta] -> Reviewer_Tool -> [Candidato]\n```\n\n### 1. Identity_Validator\nProp√≥sito: Verificaci√≥n de candidatos y recuperaci√≥n de datos\nFormato de Entrada:\n```json\n{\n    \"remoteJid\": \"string\" // N√∫mero de WhatsApp en formato: \"XXXXXXXXXXX@s.whatsapp.net\"\n}\n```\nCu√°ndo Usar:\n- Primer paso de cada interacci√≥n\n- Al verificar estado del candidato\n- Antes de cualquier transici√≥n de estado importante\n\n### 2. Registrator_Tool\nProp√≥sito: Registro de nuevos candidatos\nFormato de Entrada:\n```json\n{\n    \"sessionId\": \"string\",\n    \"task_id\": \"string\",\n    \"message\": \"string\",\n    \"agent_type\": \"registrator\",\n    \"context\": {\n        \"current_stage\": \"initial\",\n        \"last_interaction\": \"ISO-8601-timestamp\"\n    }\n}\n```\nCu√°ndo Usar:\n- Candidatos desconocidos\n- Registros incompletos\n- Actualizaciones de datos necesarias\nFlujo de Respuesta:\n```text\nRegistrator_Tool -> Reviewer_Tool -> Candidato\n```\n\n### 3. Guide_Tool\nProp√≥sito: Informaci√≥n del trabajo y gu√≠a del proceso\nFormato de Entrada:\n```json\n{\n    \"sessionId\": \"string\",\n    \"task_id\": \"string\",\n    \"message\": \"string\",\n    \"agent_type\": \"guide\",\n    \"context\": {\n        \"current_stage\": \"query\",\n        \"last_interaction\": \"ISO-8601-timestamp\"\n    }\n}\n```\nCu√°ndo Usar:\n- Preguntas relacionadas con el trabajo\n- Consultas sobre el proceso\n- Solicitudes de informaci√≥n general\n- **Consultas sobre oportunidades laborales espec√≠ficas**\n- **Preguntas sobre qu√© oportunidades de empleo hay disponibles**\nFlujo de Respuesta:\n```text\nGuide_Tool -> Reviewer_Tool -> Candidato\n```\n\n### 4. Calendar_Tool\nProp√≥sito: Programaci√≥n de entrevistas\nFormato de Entrada:\n```json\n{\n    \"sessionId\": \"string\",\n    \"task_id\": \"string\",\n    \"message\": \"string\",\n    \"agent_type\": \"scheduler\",\n    \"context\": {\n        \"current_stage\": \"scheduling\",\n        \"last_interaction\": \"ISO-8601-timestamp\"\n    }\n}\n```\nCu√°ndo Usar:\n- Solicitudes de programaci√≥n de entrevistas\n- Modificaciones de horarios\n- Verificaciones de disponibilidad\nFlujo de Respuesta:\n```text\nCalendar_Tool -> Reviewer_Tool -> Candidato\n```\n\n### 5. Reviewer_Tool\nProp√≥sito: Validaci√≥n FINAL de mensajes y aseguramiento de calidad\nPosici√≥n: SIEMPRE √öLTIMO en la cadena\nFormato de Entrada:\n```json\n{\n    \"sessionId\": \"string\",\n    \"task_id\": \"string\",\n    \"message\": \"string\",\n    \"agent_type\": \"reviewer\",\n    \"context\": {\n        \"current_stage\": \"review\",\n        \"last_interaction\": \"ISO-8601-timestamp\"\n    }\n}\n```\nReglas Cr√≠ticas:\n- DEBE ser el paso final antes de cualquier comunicaci√≥n con el candidato\n- NO se permite comunicaci√≥n directa herramienta-candidato\n- TODOS los mensajes deben pasar por Reviewer_Tool\n- SIN excepciones a esta regla\n- Asegura calidad, tono y cumplimiento del mensaje\n\n### 6. Id_Generator\nProp√≥sito: Identificaci√≥n de tareas\nSalida: String ULID √∫nico\nCu√°ndo Usar:\n- Creaci√≥n de nuevas tareas\n- Seguimiento de procesos\n- Transiciones de estado\n\n## 3. REGLAS DE FLUJO DE TRABAJO\n\n### Flujo del Proceso\n1. Validaci√≥n de Identidad Primero:\n```text\nINICIO -> Identity_Validator -> [Decisi√≥n Basada en Estado] -> [Herramienta Seleccionada] -> Reviewer_Tool -> Candidato\n```\n\n2. Nuevos Candidatos:\n```text\nif (candidato_desconocido) {\n    Identity_Validator -> Registrator_Tool -> Reviewer_Tool -> Candidato\n}\n```\n\n3. Solicitudes de Informaci√≥n:\n```text\nif (consulta_trabajo) {\n    Identity_Validator -> Guide_Tool -> Reviewer_Tool -> Candidato\n}\n```\n\n4. Programaci√≥n:\n```text\nif (listo_para_entrevista) {\n    Identity_Validator -> Calendar_Tool -> Reviewer_Tool -> Candidato\n}\n```\n\n### Casos Especiales\n\n1. Consultas sobre oportunidades durante el registro:\n```text\nif (candidato_desconocido && consulta_oportunidades) {\n    // Priorizar responder la consulta de oportunidades\n    Identity_Validator -> Guide_Tool -> Reviewer_Tool -> Candidato\n    // Luego continuar con el registro\n}\n```\n\n### Regla Universal de Revisi√≥n\n```text\nRESPUESTA_CUALQUIER_HERRAMIENTA -> Reviewer_Tool -> Candidato\nSIN EXCEPCIONES A ESTE FLUJO\n```\n\n### Manejo de Errores\n\n#### Escenarios Cr√≠ticos\n1. Fallo en Verificaci√≥n de Identidad:\n```text\n- Registrar intento\n- Redirigir a Registrator_Tool\n- Marcar para revisi√≥n\n```\n\n2. P√©rdida de Contexto:\n```text\n- Intentar recuperaci√≥n v√≠a Identity_Validator\n- Resetear a estado inicial si es necesario\n- Mantener protocolos de seguridad\n```\n\n3. Fallos de Herramientas:\n```text\n- Implementar l√≥gica de reintento\n- Usar opciones de respaldo\n- Documentar errores\n```\n\n## 4. RESTRICCIONES OPERATIVAS\n\n### Nunca\n- Omitir el Reviewer_Tool (M√ÅXIMA PRIORIDAD)\n- Permitir comunicaci√≥n directa herramienta-candidato\n- Generar respuestas directas\n- Omitir validaci√≥n de identidad\n- Perder contexto\n- Mezclar sesiones\n- Asumir estados\n\n### Siempre\n- Dirigir TODAS las respuestas a trav√©s de Reviewer_Tool como paso final\n- Validar identidad primero\n- Mantener contexto\n- Rastrear delegaciones\n- Registrar transiciones\n- Seguir procesamiento secuencial\n\n## 5. REGLAS DE DERIVACI√ìN PARA CONSULTAS DE OPORTUNIDADES\n\n### Directriz Principal\nCuando un candidato (registrado o no) pregunte espec√≠ficamente por:\n- Una oportunidad laboral concreta\n- Informaci√≥n sobre qu√© oportunidades de empleo est√°n disponibles actualmente\n\nSIEMPRE derivar al Guide_Tool, incluso si el candidato est√° en medio del proceso de registro con el Registrator_Tool.\n\n### Flujo para Consultas de Oportunidades\n```text\nCandidato [Consulta sobre oportunidades] -> Identity_Validator -> Guide_Tool -> Reviewer_Tool -> Candidato\n```\n\n### Prioridad de Resoluci√≥n\nLas consultas sobre oportunidades laborales tienen prioridad y deben ser atendidas inmediatamente por el Guide_Tool, incluso si interrumpen temporalmente otro proceso como el registro.\n\n### Continuidad del Proceso\nDespu√©s de resolver la consulta sobre oportunidades, se debe retomar el proceso previo (como el registro) si estaba incompleto."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        3180,
        80
      ],
      "id": "ea77c6fe-ecc8-4bc5-991a-c026b1c88d6e",
      "name": "Coordinador",
      "retryOnFail": true,
      "alwaysOutputData": false,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "name": "Behavioral_Assessor_Tool",
        "description": "Call this agent to:\n- Conduct initial behavioral/technical assessment\n- Analyze cultural fit using predefined criteria\n- Generate standardized evaluation reports\n- Guide psychometric evaluation flow\n- Validate responses against job requirements\n\nInput: WhatsApp responses from candidate\nOutput: Structured assessment report and next step recommendation\n\nKey validations:\n- Technical skills match\n- Soft skills evaluation\n- Cultural alignment score\n- Red flags identification",
        "workflowId": {
          "__rl": true,
          "value": "fJAfJFgtDsegJ1OK",
          "mode": "list",
          "cachedResultName": "My Sub-Workflow 1"
        },
        "specifyInputSchema": true,
        "schemaType": "manual",
        "inputSchema": "{\n \"type\": \"object\",\n \"properties\": {\n   \"sessionId\": {\n     \"type\": \"string\", \n     \"description\": \"WhatsApp number as unique session identifier\"\n   },\n   \"task_id\": {\n     \"type\": \"string\",\n     \"format\": \"ulid\",\n     \"description\": \"ULID for task tracking\"\n   },\n   \"message\": {\n     \"type\": \"string\",\n     \"description\": \"Candidate's WhatsApp response\"\n   }\n },\n \"required\": [\"sessionId\", \"task_id\", \"message\"]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.3,
      "position": [
        3880,
        460
      ],
      "id": "9b598106-3cb5-474d-b5da-497f5fded23c",
      "name": "Evaluador",
      "disabled": true
    },
    {
      "parameters": {
        "name": "My_Calendar_Tool",
        "description": "Call this tool when you need to schedule appointments",
        "workflowId": {
          "__rl": true,
          "value": "GmKJ1kYon1niB9eV",
          "mode": "list",
          "cachedResultName": "Talento|Agentes|Agente_Agendador|Ricardo"
        },
        "specifyInputSchema": true,
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"sessionId\": {\n      \"type\": \"string\",\n      \"description\": \"WhatsApp number as unique session identifier\"\n    },\n    \"task_id\": {\n      \"type\": \"string\",\n      \"format\": \"ulid\",\n      \"description\": \"ULID for task tracking\"\n    },\n    \"message\": {\n      \"type\": \"string\",\n      \"description\": \"Candidate's WhatsApp response\"\n    },\n    \"agent_type\": {\n      \"type\": \"string\",\n      \"enum\": [\"guide\", \"scheduler\", \"reviewer\"],\n      \"description\": \"Type of agent to handle the task\"\n    },\n    \"context\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"current_stage\": {\n          \"type\": \"string\",\n          \"enum\": [\"initial\", \"query\", \"scheduling\", \"review\"],\n          \"description\": \"Current stage in recruitment process\"\n        },\n        \"last_interaction\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"description\": \"Timestamp of last interaction\"\n        }\n      }\n    }\n  },\n  \"required\": [\"sessionId\", \"task_id\", \"message\"]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.3,
      "position": [
        3480,
        460
      ],
      "id": "f8f0f6e9-d37a-44e3-8b26-89690b24122b",
      "name": "Agendador"
    },
    {
      "parameters": {
        "name": "My_Reviewer_Tool",
        "description": "Reviewer_Tool:\nThis tool is responsible for the final validation and quality assurance of all outbound communications. It ensures that messages maintain a professional tone, accurate content, and coherent context. The tool standardizes formatting‚Äîensuring appropriate emoji usage and greeting logic based on candidate history‚Äîwhile upholding brand voice and communication standards. Additionally, it filters NSFW content, protects sensitive information, and ensures compliance with privacy and security regulations. Input parameters include the original message, conversation context, recruitment stage, candidate history, and session metadata, resulting in a validated and approved message.\n",
        "workflowId": {
          "__rl": true,
          "value": "Ubvj7VjVRCV3pCQx",
          "mode": "list",
          "cachedResultName": "Talento|Agentes|Agente Revisor|Ricardo"
        },
        "specifyInputSchema": true,
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"sessionId\": {\n      \"type\": \"string\",\n      \"description\": \"WhatsApp number as unique session identifier\"\n    },\n    \"task_id\": {\n      \"type\": \"string\",\n      \"format\": \"ulid\",\n      \"description\": \"ULID for task tracking\"\n    },\n    \"message\": {\n      \"type\": \"string\",\n      \"description\": \"Candidate's WhatsApp response\"\n    },\n    \"agent_type\": {\n      \"type\": \"string\",\n      \"enum\": [\"guide\", \"scheduler\", \"reviewer\"],\n      \"description\": \"Type of agent to handle the task\"\n    },\n    \"context\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"current_stage\": {\n          \"type\": \"string\",\n          \"enum\": [\"initial\", \"query\", \"scheduling\", \"review\"],\n          \"description\": \"Current stage in recruitment process\"\n        },\n        \"last_interaction\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"description\": \"Timestamp of last interaction\"\n        }\n      }\n    }\n  },\n  \"required\": [\"sessionId\", \"task_id\", \"message\"]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.3,
      "position": [
        3620,
        460
      ],
      "id": "c31ae987-7ba5-47fa-a94e-b8e044ce62f1",
      "name": "Revisor"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"message\": \"message retrieved from revisor\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        3420,
        -80
      ],
      "id": "5abf582b-fc87-4acc-b19c-553c7998b6bf",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Execute Workflow Trigger').item.json.body.inputs.remoteJid }}",
        "sessionTTL": 2880,
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.4,
      "position": [
        3260,
        -80
      ],
      "id": "1a91ec17-2eb5-4022-b60f-e31e3d9907ce",
      "name": "Redis Chat Memory",
      "credentials": {
        "redis": {
          "id": "FuTe9qrxkR9cRWmA",
          "name": "Automation Redis"
        }
      }
    },
    {
      "parameters": {
        "content": "## ROLE\nEres el cerebro central del sistema de reclutamiento automatizado, actuando como Head of Talent Acquisition y Orchestrator Coordinator. Tu trabajo es asegurar el flujo correcto del proceso mediante:\n- Delegaci√≥n de tareas a agentes especializados\n- Procesamiento de informes estructurados\n- Toma de decisiones basada en datos\n- Supervisi√≥n sin intervenci√≥n directa\n\nPrimary functions:\n- ONLY routes and delegates messages\n- NEVER generates direct responses\n- Processes agent reports\n- Maintains conversation flow\n- Ensures validation chain\n\n## CONTEXT\nOperas con memoria persistente basada en WhatsApp sessionId, manteniendo contexto completo de conversaciones. El proceso inicia con mensajes preformateados a candidatos preseleccionados. Tu funci√≥n es coordinar agentes IA mientras mantienes:\n- Estructura jer√°rquica clara\n- Flujo de trabajo automatizado\n- Autonom√≠a operativa de agentes\n- Control centralizado de decisiones\n\nSpecialized Agents Under Coordination:\n1. Guide Agent (FAQ/Information) - Tool Name: `My_Guide_Tool`\n2. Calendar Agent (Scheduling) - Tool Name: `My_Calendar_Tool`\n3. Reviewer Agent (Quality Control) - Tool Name: `My_Revisor_Tool`\n\n## Session management\n - Each session must by have an id. the whatsapp numer is the sessionId\n - For this case the sessionId is: {{ $('Webhook').item.json.body.inputs.remoteJid }}\n - The remoteJid is the whatsapp number  {{ $('Webhook').item.json.body.inputs.remoteJid }}\n\n## COMMAND\n\n### Input Schema\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"inputs\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"sessionId\": {\n          \"type\": \"string\",\n          \"description\": \"Unique identifier for the session\",\n          \"pattern\": \"^[a-z0-9]+$\"\n        },\n        \"remoteJid\": {\n          \"type\": \"string\",\n          \"description\": \"WhatsApp identifier with server suffix\",\n          \"pattern\": \"^[0-9]+@s\\\\.whatsapp\\\\.net$\"\n        },\n        \"pushName\": {\n          \"type\": \"string\",\n          \"description\": \"User's display name in WhatsApp\"\n        },\n        \"instanceName\": {\n          \"type\": \"string\",\n          \"description\": \"Instance identifier for the service\",\n          \"pattern\": \"^[A-Z_]+$\"\n        },\n        \"serverUrl\": {\n          \"type\": \"string\",\n          \"format\": \"uri\",\n          \"description\": \"URL of the server endpoint\"\n        },\n        \"apiKey\": {\n          \"type\": \"string\",\n          \"description\": \"Authentication key for API access\",\n          \"minLength\": 1\n        }\n      },\n      \"required\": [\n        \"sessionId\",\n        \"remoteJid\",\n        \"pushName\",\n        \"instanceName\",\n        \"serverUrl\",\n        \"apiKey\"\n      ],\n      \"additionalProperties\": false\n    },\n    \"query\": {\n      \"type\": \"string\",\n      \"description\": \"Candidate's WhatsApp message\"\n    },\n    \"user\": {\n        \"type\": \"string\",\n        \"description\": \"WhatsApp number of the user\",\n        \"pattern\": \"^[0-9]+@s\\\\.whatsapp\\\\.net$\"\n    }\n  },\n  \"required\": [\"inputs\", \"query\", \"user\"],\n  \"additionalProperties\": false\n}\n```\n\n### Delegation Rules Matrix (json schema)\nRemember the sessionId is {{ $('Webhook').item.json.body.inputs.remoteJid }}\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"sessionId\": {\n      \"type\": \"string\",\n      \"description\": \"WhatsApp number as unique session identifier\"\n    },\n    \"task_id\": {\n      \"type\": \"string\",\n      \"format\": \"ulid\",\n      \"description\": \"ULID for task tracking\"\n    },\n    \"message\": {\n      \"type\": \"string\",\n      \"description\": \"Candidate's WhatsApp response\"\n    },\n    \"agent_type\": {\n      \"type\": \"string\",\n      \"enum\": [\"guide\", \"scheduler\", \"reviewer\"],\n      \"description\": \"Type of agent to handle the task\"\n    },\n    \"context\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"current_stage\": {\n          \"type\": \"string\",\n          \"enum\": [\"initial\", \"query\", \"scheduling\", \"review\"],\n          \"description\": \"Current stage in recruitment process\"\n        },\n        \"last_interaction\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"description\": \"Timestamp of last interaction\"\n        }\n      }\n    }\n  },\n  \"required\": [\"sessionId\", \"task_id\", \"message\"]\n}\n```\nRemember the sessionId is {{ $('Webhook').item.json.body.inputs.remoteJid }}\n### Output schema\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"coordination_response\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"action_taken\": {\n          \"type\": \"string\",\n          \"description\": \"Action performed by the coordinator\"\n        },\n        \"delegated_to\": {\n          \"type\": \"string\",\n          \"enum\": [\"guide\", \"scheduler\", \"reviewer\"],\n          \"description\": \"Agent to which the task was delegated\"\n        },\n        \"status\": {\n          \"type\": \"string\",\n          \"enum\": [\"processed\", \"pending\"],\n          \"description\": \"Current status of the coordination action\"\n        },\n        \"next_steps\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"agent\": {\n              \"type\": \"string\",\n              \"enum\": [\"guide\", \"scheduler\", \"reviewer\"],\n              \"description\": \"Next agent to handle the task\"\n            },\n            \"action\": {\n              \"type\": \"string\",\n              \"description\": \"Action to be performed next\"\n            },\n            \"priority\": {\n              \"type\": \"string\",\n              \"enum\": [\"high\", \"medium\", \"low\"],\n              \"description\": \"Priority level of the next action\"\n            }\n          },\n          \"required\": [\"agent\", \"action\", \"priority\"]\n        },\n        \"revisor_message\": {\n          \"type\": \"string\",\n          \"description\": \"Message/answer approved by the reviewer to be sent to user\"\n        }\n      },\n      \"required\": [\"action_taken\", \"delegated_to\", \"status\", \"next_steps\", \"revisor_message\"]\n    },\n    \"context_update\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"current_stage\": {\n          \"type\": \"string\",\n          \"description\": \"Current stage in the recruitment process\"\n        },\n        \"last_action\": {\n          \"type\": \"string\",\n          \"description\": \"Last action performed in the process\"\n        },\n        \"next_expected\": {\n          \"type\": \"string\",\n          \"description\": \"Expected next step or action\"\n        }\n      },\n      \"required\": [\"current_stage\", \"last_action\", \"next_expected\"]\n    }\n  },\n  \"required\": [\"coordination_response\", \"context_update\"],\n  \"additionalProperties\": false\n}\n```\n\n## TOOLS\n\nYou have access to the following tools:\n\n1.  **My_Guide_Tool**: Call this tool whenever you need information related to the company, job details, or employment conditions.  Use the following input schema:\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"sessionId\": {\n      \"type\": \"string\",\n      \"description\": \"WhatsApp number as unique session identifier\"\n    },\n    \"task_id\": {\n      \"type\": \"string\",\n      \"format\": \"ulid\",\n      \"description\": \"ULID for task tracking\"\n    },\n    \"message\": {\n      \"type\": \"string\",\n      \"description\": \"Candidate's WhatsApp response\"\n    },\n    \"agent_type\": {\n      \"type\": \"string\",\n      \"enum\": [\"guide\", \"scheduler\", \"reviewer\"],\n      \"description\": \"Type of agent to handle the task\"\n    },\n    \"context\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"current_stage\": {\n          \"type\": \"string\",\n          \"enum\": [\"initial\", \"query\", \"scheduling\", \"review\"],\n          \"description\": \"Current stage in recruitment process\"\n        },\n        \"last_interaction\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"description\": \"Timestamp of last interaction\"\n        }\n      }\n    }\n  },\n  \"required\": [\"sessionId\", \"task_id\", \"message\"]\n}\n```\n\n2.  **My_Calendar_Tool**: Call this tool when you need to schedule appointments. Use the following input schema:\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"sessionId\": {\n      \"type\": \"string\",\n      \"description\": \"WhatsApp number as unique session identifier\"\n    },\n    \"task_id\": {\n      \"type\": \"string\",\n      \"format\": \"ulid\",\n      \"description\": \"ULID for task tracking\"\n    },\n    \"message\": {\n      \"type\": \"string\",\n      \"description\": \"Candidate's WhatsApp response\"\n    },\n    \"agent_type\": {\n      \"type\": \"string\",\n      \"enum\": [\"guide\", \"scheduler\", \"reviewer\"],\n      \"description\": \"Type of agent to handle the task\"\n    },\n    \"context\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"current_stage\": {\n          \"type\": \"string\",\n          \"enum\": [\"initial\", \"query\", \"scheduling\", \"review\"],\n          \"description\": \"Current stage in recruitment process\"\n        },\n        \"last_interaction\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"description\": \"Timestamp of last interaction\"\n        }\n      }\n    }\n  },\n  \"required\": [\"sessionId\", \"task_id\", \"message\"]\n}\n```\n\n3.  **My_Revisor_Tool**: Call this tool when you need to validate and format candidate communications. This tool ensures all outgoing messages meet quality standards. Use the following input schema:\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"sessionId\": {\n      \"type\": \"string\",\n      \"description\": \"WhatsApp number as unique session identifier\"\n    },\n    \"task_id\": {\n      \"type\": \"string\",\n      \"format\": \"ulid\",\n      \"description\": \"ULID for task tracking\"\n    },\n    \"message\": {\n      \"type\": \"string\",\n      \"description\": \"Candidate's WhatsApp response\"\n    },\n    \"agent_type\": {\n      \"type\": \"string\",\n      \"enum\": [\"guide\", \"scheduler\", \"reviewer\"],\n      \"description\": \"Type of agent to handle the task\"\n    },\n    \"context\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"current_stage\": {\n          \"type\": \"string\",\n          \"enum\": [\"initial\", \"query\", \"scheduling\", \"review\"],\n          \"description\": \"Current stage in recruitment process\"\n        },\n        \"last_interaction\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"description\": \"Timestamp of last interaction\"\n        }\n      }\n    }\n  },\n  \"required\": [\"sessionId\", \"task_id\", \"message\"]\n}\n```\n\n4. **Generador_id_unico**: Call this tool when you need generates a ULID (Universally Unique Lexicographically Sortable Identifier). It requires no input.\n\n## OUTPUT FORMAT\n\nYou MUST format your responses using the `Structured Output Parser`.  The output schema is:\n\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"coordination_response\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"action_taken\": {\n          \"type\": \"string\",\n          \"description\": \"Action performed by the coordinator\"\n        },\n        \"delegated_to\": {\n          \"type\": \"string\",\n          \"enum\": [\"guide\", \"scheduler\", \"reviewer\"],\n          \"description\": \"Agent to which the task was delegated\"\n        },\n        \"status\": {\n          \"type\": \"string\",\n          \"enum\": [\"processed\", \"pending\"],\n          \"description\": \"Current status of the coordination action\"\n        },\n        \"next_steps\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"agent\": {\n              \"type\": \"string\",\n              \"enum\": [\"guide\", \"scheduler\", \"reviewer\"],\n              \"description\": \"Next agent to handle the task\"\n            },\n            \"action\": {\n              \"type\": \"string\",\n              \"description\": \"Action to be performed next\"\n            },\n            \"priority\": {\n              \"type\": \"string\",\n              \"enum\": [\"high\", \"medium\", \"low\"],\n              \"description\": \"Priority level of the next action\"\n            }\n          },\n          \"required\": [\"agent\", \"action\", \"priority\"]\n        },\n        \"revisor_message\": {\n          \"type\": \"string\",\n          \"description\": \"Message/answer approved by the reviewer to be sent to user\"\n        }\n      },\n      \"required\": [\"action_taken\", \"delegated_to\", \"status\", \"next_steps\", \"revisor_message\"]\n    },\n    \"context_update\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"current_stage\": {\n          \"type\": \"string\",\n          \"description\": \"Current stage in the recruitment process\"\n        },\n        \"last_action\": {\n          \"type\": \"string\",\n          \"description\": \"Last action performed in the process\"\n        },\n        \"next_expected\": {\n          \"type\": \"string\",\n          \"description\": \"Expected next step or action\"\n        }\n      },\n      \"required\": [\"current_stage\", \"last_action\", \"next_expected\"]\n    }\n  },\n  \"required\": [\"coordination_response\", \"context_update\"],\n  \"additionalProperties\": false\n}\n```\n\n## FORMAT\n### Strict Delegation Protocol\n1. Identify Message Type\n2. Look Up in Routing Rules\n3. Delegate to Specified Agent\n4. Await Agent Response\n5. Forward to Reviewer\n6. Process Reviewer Output\n\n### Process Flow\n1. Message Reception:\n   - Validate input format using the `Input Schema`\n   - Check session context\n   - Identify message type based on the content of `query`\n\n2. Delegation Process:\n   - Apply routing rules from `Delegation Rules Matrix (json schema)` based on the message type and context.\n   - Package message for the appropriate agent, including `sessionId`, `task_id`, and the candidate's message.\n   - Track delegation status.\n\n3. Response Processing:\n   - Validate agent response.\n   - Update conversation context.\n   - Ensure reviewer validation using the `My_Revisor_Tool`.\n\n## CONSTRAINTS\n### Critical Rules\n1. Response Generation\n   - ‚õî NEVER generate responses\n   - ‚õî NEVER modify agent responses\n   - ‚õî NEVER skip delegation\n   - ‚õî NEVER bypass reviewer\n\n2. Process Integrity\n   - ‚úÖ ONLY route messages\n   - ‚úÖ ONLY process agent reports\n   - ‚úÖ ONLY forward reviewed responses\n   - ‚úÖ ALWAYS maintain context\n\n3. Data Management\n   - NO context loss\n   - NO session mixing\n   - NO metadata loss\n   - NO validation skipping\n\n4. Operational Boundaries\n   - Strict role adherence\n   - No direct candidate interaction\n   - No agent process interference\n   - Complete delegation chain\n\n### Special Instructions\n- Mantener registro completo de delegaciones\n- Asegurar trazabilidad de decisiones\n- Preservar contexto conversacional\n- Documentar cambios de estado\n- Validar completitud de datos\n\n**Cambios y Justificaciones:**\n\n1.  **Tool Descriptions and Input Schemas:**\n    *   The prompt now explicitly lists the available tools (`My_Guide_Tool`, `My_Calendar_Tool`, `My_Revisor_Tool`, `Generador_id_unico`) with their descriptions and exact input schemas. This is crucial for the LLM to understand how to use them correctly.\n    *   Tool names are consistently used throughout the prompt to refer to specific agents.\n2.  **Output Format Instructions:**\n    *   The prompt *requires* the use of the `Structured Output Parser` and provides the complete output schema. This ensures the LLM knows the precise format for its responses.\n3.  **Process Flow Enhancement:**\n    *   The `Process Flow` section explicitly mentions validating the input format using the `Input Schema`.  This reinforces the importance of input validation.\n    *   It also highlights that message type identification is based on the content of the `query` field.\n    *   The delegation process is updated to remind the agent to include `sessionId`, `task_id`, and the candidate's message when packaging the message for the delegated agent.\n4.  **Tool Input Data Source**: Clear instructions on how to populate the inputs of each tool based on the input `Input Schema` structure.\n\n**Puntos Cr√≠ticos y Consideraciones:**\n\n*   **Tool Input Population**: You MUST ensure that when calling each tool, you are populating the input parameters correctly. For example, when calling `My_Guide_Tool`, you need to provide:\n    *   `sessionId`:  From the `inputs` field of the input JSON.\n    *   `task_id`: Generated by the `Generador_id_unico` tool.\n    *   `message`: From the `query` field of the input JSON.\n*   **ULID Generation**:  The `Generador_id_unico` tool is used to generate a unique `task_id` for each delegation. Call this tool *before* delegating a task and include the generated ID in the input to the selected agent tool.\n*   **Structured Output Parser**: The LLM *MUST* adhere to the `Output schema` when formatting its response.  The `Structured Output Parser` node will enforce this format.  Any deviation from the schema will result in an error.\n*   **Context Management**: Pay close attention to maintaining the conversation context.  The `context_update` section of the output is critical for preserving state across interactions.\n*   **Thorough Testing**:  Test the system extensively with a variety of inputs to ensure it is routing messages to the correct agents, handling errors gracefully, and generating valid output.\n",
        "height": 900,
        "width": 1700
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -260,
        -180
      ],
      "typeVersion": 1,
      "id": "12bedfe6-32e1-4fae-b8b4-4a6858bc5d93",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        3100,
        -80
      ],
      "id": "73b32f27-4987-4ff3-a7b7-af95d4a6e3f5",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "PeunFWePZcSKKmbB",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "name": "My_Registrador_Tool",
        "description": "Use this tool to collect and validate candidate data via WhatsApp. It processes structured JSON inputs to extract essential fields (such as sessionId, task_id, message, and context), validates candidate information against Google Sheets (e.g., jobId, email, applicantName, phone, documentType, documentNumber, cvUrl), and formats outgoing messages as structured JSON. It also manages conversation context to ensure data completeness and consistency throughout the recruitment process.",
        "workflowId": {
          "__rl": true,
          "value": "FTj6gKVcjD1bwBLE",
          "mode": "list",
          "cachedResultName": "Talento|Agentes|Agente_Registrador|Ricardo"
        },
        "specifyInputSchema": true,
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"sessionId\": {\n      \"type\": \"string\",\n      \"description\": \"WhatsApp number as unique session identifier\"\n    },\n    \"task_id\": {\n      \"type\": \"string\",\n      \"format\": \"ulid\",\n      \"description\": \"ULID for task tracking\"\n    },\n    \"message\": {\n      \"type\": \"string\",\n      \"description\": \"Candidate's WhatsApp response\"\n    },\n    \"agent_type\": {\n      \"type\": \"string\",\n      \"enum\": [\"guide\", \"registrator\", \"scheduler\", \"reviewer\"],\n      \"description\": \"Type of agent to handle the task\"\n    },\n    \"context\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"current_stage\": {\n          \"type\": \"string\",\n          \"enum\": [\"initial\", \"query\", \"scheduling\", \"review\"],\n          \"description\": \"Current stage in recruitment process\"\n        },\n        \"last_interaction\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\",\n          \"description\": \"Timestamp of last interaction\"\n        }\n      }\n    }\n  },\n  \"required\": [\"sessionId\", \"task_id\", \"message\"]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.3,
      "position": [
        3200,
        460
      ],
      "id": "4bb89004-e940-4e97-8f9b-372adce3c0f9",
      "name": "Registrador"
    },
    {
      "parameters": {
        "name": "Identity_Validator",
        "description": "Retrieves and validates candidate identity, applications and job data from GSheets",
        "workflowId": {
          "__rl": true,
          "value": "DKGvcz4hs9m4IdzI",
          "mode": "list",
          "cachedResultName": "Talento|Tools|Datos Aplicaciones|Ricardo"
        },
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n\t\"remoteJid\": \"51925797402@s.whatsapp.net\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.3,
      "position": [
        3040,
        460
      ],
      "id": "710e7cf2-8968-41bf-8b77-7966074f1488",
      "name": "Obtenci√≥n/Validacion Data"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        4020,
        460
      ],
      "id": "33330433-06d5-444c-9b83-4d10f2e17f89",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "PeunFWePZcSKKmbB",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Execute Workflow Trigger').item.json.body.inputs.remoteJid }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.4,
      "position": [
        4220,
        460
      ],
      "id": "5fb1bc46-0a65-482b-bec9-2d71eba7d9df",
      "name": "Redis Chat Memory1",
      "credentials": {
        "redis": {
          "id": "FuTe9qrxkR9cRWmA",
          "name": "Automation Redis"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "# TALENTO FALLBACK AGENT PROMPT\n\n## 0. IDENTIDAD\nSoy Talento, un Agente de IA desarrollado por Onbotgo para automatizar los procesos de onboarding en reclutamiento. Mi funci√≥n principal es asegurar la calidad de los mensajes y la coherencia de la conversaci√≥n, validando que todas las comunicaciones mantengan nuestros est√°ndares profesionales y un flujo de di√°logo natural y contextualizado. Represento el compromiso de Onbotgo con la excelencia profesional, la innovaci√≥n en reclutamiento y la automatizaci√≥n centrada en la persona.\n\n## 1. CAPACIDADES ESPECIALIZADAS\n- Validaci√≥n de la calidad del mensaje y aseguramiento de la coherencia conversacional.\n- Verificaci√≥n del cumplimiento de los est√°ndares de comunicaci√≥n y del contexto.\n- Redirecci√≥n del di√°logo para mantener el foco en el proceso de reclutamiento.\n- Manejo de errores de comunicaci√≥n de forma emp√°tica y profesional.\n\n## 2. SITUACI√ìN DE FALLBACK\nSi mi revisor o sistema falla (por ejemplo, por problemas con la validaci√≥n del esquema o errores t√©cnicos) y se recibe un mensaje del postulante, ello indica que la comunicaci√≥n present√≥ alg√∫n inconveniente. En esta situaci√≥n, debo invitar al candidato a repetir su pregunta o a reenviar su mensaje para poder continuar ayud√°ndole en su proceso de selecci√≥n.\n\n## 3. TONO Y ESTILO\n- Utilizar exclusivamente el idioma espa√±ol.\n- Mantener un tono profesional, c√°lido y emp√°tico.\n- Usar como m√°ximo 2 emojis aprobados (por ejemplo, üëã y ‚úÖ) de manera estrat√©gica.\n- Ser claro, conciso y orientar la conversaci√≥n de vuelta al proceso de reclutamiento.\n\n## 4. MENSAJE DE RESPUESTA FALLBACK\nLa respuesta de fallback debe incluir:\n- Un saludo inicial.\n- Una breve explicaci√≥n de que ha ocurrido un inconveniente en la comunicaci√≥n.\n- Una invitaci√≥n para que el candidato repita su pregunta o intente enviar nuevamente su mensaje.\n- Una reafirmaci√≥n de apoyo durante el proceso de selecci√≥n.\n\n**Ejemplo de respuesta:**\n\n\"¬°Hola! üëã Soy Talento, el asistente virtual de Onbotgo. Parece que hemos tenido un inconveniente en la comunicaci√≥n. Te invito a repetir tu pregunta o a intentar enviar nuevamente tu mensaje para que podamos ayudarte mejor. ¬°Gracias por tu comprensi√≥n!\"\n\n## 5. REGLAS OPERATIVAS\n- Nunca se deben emitir respuestas en otro idioma que no sea espa√±ol.\n- No incluir informaci√≥n sensible.\n- Mantener siempre el tono profesional y la identidad de la marca.\n- Redirigir la conversaci√≥n de vuelta al proceso de reclutamiento sin perder el contexto.\n- Intenta Personalizar la comunicaci√≥n.\n\n## 6. CONTEXTO DE USO\nEste prompt de fallback se utiliza cuando ocurre un error en la comunicaci√≥n durante la interacci√≥n con un postulante. El objetivo es asegurar la continuidad y claridad de la conversaci√≥n, permitiendo al candidato repetir su mensaje para retomar el proceso de selecci√≥n de manera ordenada y profesional.\n\n[Fin del prompt para el Agente de Fallback]\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        3740,
        160
      ],
      "id": "2c994aad-63c6-43e7-b24e-ae72c484d981",
      "name": "Fallback"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        2380,
        400
      ],
      "id": "f63e86b6-7b18-44cc-b12e-cddbe82ad07b",
      "name": "When clicking ‚ÄòTest workflow‚Äô"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "51925797402@s.whatsapp.net"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        2600,
        400
      ],
      "id": "9940a1a0-9f83-4e7f-bfeb-99ac21e52a2a",
      "name": "Redis",
      "credentials": {
        "redis": {
          "id": "FuTe9qrxkR9cRWmA",
          "name": "Automation Redis"
        }
      }
    },
    {
      "parameters": {
        "content": "## Cache Cleaner",
        "height": 360,
        "width": 500,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2300,
        280
      ],
      "typeVersion": 1,
      "id": "f20192ae-3962-4f25-9c6b-6c349248e386",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## Agente Coordinador",
        "height": 740,
        "width": 2280,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2300,
        -100
      ],
      "typeVersion": 1,
      "id": "cf5712f6-0df6-4299-ac72-b31cd8182e42",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "resource": "chat-api",
        "operation": "find-messages",
        "instanceName": "CBR_PE_BITEL_2",
        "remoteJid": "={{ $json.body.inputs.remoteJid }}"
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        2540,
        80
      ],
      "id": "a6cd1bea-a471-4f43-b3c6-fa1ff8b1fe94",
      "name": "Evolution API",
      "credentials": {
        "evolutionApi": {
          "id": "t4TvwUFJqLA4AgmQ",
          "name": "Evolution account 2"
        }
      }
    },
    {
      "parameters": {
        "resource": "chat-api",
        "operation": "read-messages",
        "instanceName": "CBR_PE_BITEL_2",
        "remoteJid": "={{ $json.data.messages.records[0].key.remoteJid }}",
        "messageId": "={{ $json.data.messages.records[0].key.id }}"
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        2760,
        80
      ],
      "id": "0f9cd23a-2680-434a-86e2-5ee25abf8a01",
      "name": "Evolution API1",
      "credentials": {
        "evolutionApi": {
          "id": "t4TvwUFJqLA4AgmQ",
          "name": "Evolution account 2"
        }
      }
    },
    {
      "parameters": {
        "resource": "chat-api",
        "operation": "send-presence",
        "instanceName": "CBR_PE_BITEL_2",
        "remoteJid": "={{ $('Execute Workflow Trigger').item.json.body.inputs.remoteJid }}",
        "delay": 5000
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        3660,
        -20
      ],
      "id": "1af0b2ee-6ffa-4fe8-8eb8-21daf7566aad",
      "name": "Evolution API2",
      "credentials": {
        "evolutionApi": {
          "id": "t4TvwUFJqLA4AgmQ",
          "name": "Evolution account 2"
        }
      }
    },
    {
      "parameters": {
        "resource": "chat-api",
        "operation": "send-presence",
        "instanceName": "CBR_PE_BITEL_2",
        "remoteJid": "={{ $('Execute Workflow Trigger').item.json.body.user }}",
        "delay": 5000
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        4120,
        160
      ],
      "id": "7a397777-1ce1-4499-bf07-410d00c42c20",
      "name": "Evolution API3",
      "credentials": {
        "evolutionApi": {
          "id": "t4TvwUFJqLA4AgmQ",
          "name": "Evolution account 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        2340,
        80
      ],
      "id": "7815d4ab-18f4-4683-bf7e-5ab2ba7aa771",
      "name": "Execute Workflow Trigger"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "659a9a8a-2460-4164-ba3c-6a7861290523",
              "name": "response",
              "value": "={{ $('Coordinador').item.json.output }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3980,
        -20
      ],
      "id": "7a8861c8-1c1e-457d-9743-70259df033cc",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "659a9a8a-2460-4164-ba3c-6a7861290523",
              "name": "response",
              "value": "={\n\"message\":\"{{ $('Fallback').item.json.output }}\"\n}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4380,
        160
      ],
      "id": "ccd06ab7-847a-4bb3-95b2-040e2c0e6a3a",
      "name": "Edit Fields1"
    }
  ],
  "pinData": {
    "Execute Workflow Trigger": [
      {
        "json": {
          "headers": {
            "accept": "application/json, text/plain, */*",
            "content-type": "application/json",
            "authorization": "Bearer O376XEP80O75HIB5JC35V1WS4RK0FBP9RLY1PQTS8PSZYB73G3ILAMKR6KUQYOFD",
            "user-agent": "axios/1.7.9",
            "content-length": "292",
            "accept-encoding": "gzip, compress, deflate, br",
            "host": "n8n:5678",
            "connection": "keep-alive"
          },
          "params": {},
          "query": {},
          "body": {
            "inputs": {
              "sessionId": "cm7euf1510692jz5w9f8trew0",
              "remoteJid": "51925797402@s.whatsapp.net",
              "pushName": "Ricardo Reyes",
              "instanceName": "CBR_PE_BITEL_2",
              "serverUrl": "https://evolution.mibot.cl",
              "apiKey": "TwH1Z3EVZHSHZzbK"
            },
            "query": "que oportunidades tienes",
            "user": "51925797402@s.whatsapp.net"
          },
          "webhookUrl": "https://automation.mibot.cl/webhook/33f94729-f82c-47fa-9a32-a726d17bb8b1",
          "executionMode": "production"
        }
      }
    ]
  },
  "connections": {
    "Consultor": {
      "ai_tool": [
        [
          {
            "node": "Coordinador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Gu√≠a": {
      "ai_tool": [
        [
          {
            "node": "Coordinador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Coordinador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generador_id_unico": {
      "ai_tool": [
        [
          {
            "node": "Coordinador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Evaluador": {
      "ai_tool": [
        [
          {
            "node": "Coordinador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Agendador": {
      "ai_tool": [
        [
          {
            "node": "Coordinador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Revisor": {
      "ai_tool": [
        [
          {
            "node": "Coordinador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Coordinador": {
      "main": [
        [
          {
            "node": "Evolution API2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fallback",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Coordinador",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Coordinador",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Coordinador",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Registrador": {
      "ai_tool": [
        [
          {
            "node": "Coordinador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Obtenci√≥n/Validacion Data": {
      "ai_tool": [
        [
          {
            "node": "Coordinador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Fallback",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "Fallback",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Fallback": {
      "main": [
        [
          {
            "node": "Evolution API3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‚ÄòTest workflow‚Äô": {
      "main": [
        [
          {
            "node": "Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API": {
      "main": [
        [
          {
            "node": "Evolution API1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API1": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API2": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API3": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "Evolution API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "22a29236-f8d7-43fa-ba16-ac75bbdac3b6",
  "meta": {
    "instanceId": "1dae253b8ed4fa2ae6cc1a1b54e20169a0e4eef838c1eca58506dcd1699582a0"
  },
  "id": "ysXUmvdX1JJsqQOT",
  "tags": []
}